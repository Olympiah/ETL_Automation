name: data-flow-pipeline

on: 
  push:
  workflow_dispatch:
  schedule:
    - cron: '33 15 25 8 5'

jobs:
  pipeline_data:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest]
        # python-version: '3.9'

    steps:
    - name: Checkout repo content
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.PERSONAL_ACCESS_TOKEN }}

    - name: Set up Python 
      uses: actions/setup-python@v5
      with:
        python-version: ${{ matrix.python-version }}
        cache: 'pip'
        
    - name: Install dependencies
      run: pip install -r requirements.txt
    - name: Run datapipeline
      env: 
        YT_API_KEY: ${{ secrets.YT_API_KEY}}
        PLAYLIST_ID: ${{ secrets.PLAYLIST_ID }} 
        GOOGLE_API_KEY: ${{ secrets.GOOGLE_API_KEY }}
      run: python data_pipeline.py

    - name: Check for changes
      id: git-check
      run: |
          git config user.name 'github-actions'
          git config user.email 'github-actions@github.com'
          git add .
          git diff --staged --quiet || echo "changes=true" >> $GITHUB_ENV 

    - name: Commit and push if changes
      if: env.changes == 'true' # if changes made push new data to repo
      run: |
          git commit -m "updated video index"
          git push
    
     
